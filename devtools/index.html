<!DOCTYPE html>
<html>
<head>
    <title></title>
    <style type="text/css">
        body {
            background: url("../PSD/960grid.png");
        }
    </style>
    <link rel="stylesheet" type="text/css" href="../css/font-awesome/css/font-awesome.css">       
    <link rel="stylesheet" type="text/css" href="../css/note/basic.css">
    <link rel="stylesheet" type="text/css" href="../css/note/theme-blue.css">
    <link rel="stylesheet" type="text/css" href="../css/note/theme-black.css">
    <link rel="stylesheet" type="text/css" href="../css/note/theme-green.css">
    <link rel="stylesheet" type="text/css" href="../css/note/transform.css">
    <link rel="stylesheet" type="text/css" href="../css/transform.css">    
    <link rel="stylesheet" type="text/css" href="../css/note/transform.css">    
    <script type="text/javascript" src="../js/lib/lib.js"></script>
    <script type="text/javascript" src="../js/lib/class.js"></script>
    <script type="text/javascript">
        var Note = Class.extend({
            property: {
                tpl: [
                    '<!-- 如果是在翻动状态则需要在外容器添加 chromeNote-3d-flipStatus-->',
                    '<div id="chromeNote-noteItem-flipCard" class="chromeNote-noteItem-flipCard chromeNote-setup-3d-style">',
                        '<div class="chromeNote-noteItem-wrap chromeNote-setup-3d-style chromeNote-3d-backface-hidden">',
                            '<div class="chromeNote-noteItem-header">',
                                '<span id="chromeNote-noteItem-header-label-date" class="chromeNote-noteItem-header-date">2012.9.9 23:09</span>',
                                '<span class="chromeNote-noteItem-header-iconWrap">',
                                    '<i id="chromeNote-noteItem-header-btn-config"  class="icon-gear chromeNote-noteItem-header-icon"></i>',
                                    '<i id="chromeNote-noteItem-header-btn-mini" class="icon-minus-sign chromeNote-noteItem-header-icon"></i>',
                                '</span>',
                            '</div>',
                            '<textarea class="chromeNote-noteItem-textarea"></textarea>',
                            '<div id="chromeNote-noteItem-footer" class="chromeNote-noteItem-footer chromeNote-noteItem-footer-hide">',
                                '<table id="chromeNote-noteItem-footer-menu"  class="chromeNote-noteItem-grid chromeNote-noteItem-grid2 chromeNote-noteItem-footer-menu">',
                                    '<tbody>',
                                        '<tr>',
                                            '<td id="chromeNote-noteItem-menu-color" ><i class="icon-tint"></i></td>',
                                            '<td id="chromeNote-noteItem-menu-remove"><i class="icon-trash"></td>',
                                        '</tr>',
                                    '</tbody>',
                                '</table>',
                                '<table id="chromeNote-noteItem-footer-color" class="chromeNote-noteItem-grid chromeNote-noteItem-grid3 chromeNote-noteItem-footer-color">',
                                    '<tbody>',
                                        '<tr>',
                                            '<td><div id="chromeNote-noteItem-footer-colorItem-blue" class="chromeNote-noteItem-footer-colorItem chromeNote-noteItem-footer-colorItem-blue"><em data-noteItem-color="blue" data-noteItem-allColor="blue&black&green"></em></div></td>',
                                            '<td><div id="chromeNote-noteItem-footer-colorItem-black" class="chromeNote-noteItem-footer-colorItem chromeNote-noteItem-footer-colorItem-black"><em data-noteItem-color="black"  data-noteItem-allColor="blue&black&green"></em></div></td>',
                                            '<td><div id="chromeNote-noteItem-footer-colorItem-green" class="chromeNote-noteItem-footer-colorItem chromeNote-noteItem-footer-colorItem-green"><em data-noteItem-color="green"  data-noteItem-allColor="blue&black&green"></em></div></td>',
                                        '</tr>',
                                    '</tbody>',
                                '</table>',
                            '</div>',
                        '</div>',
                        '<div class="chromeNote-noteItem-miniIcon-wrap chromeNote-setup-3d-style chromeNote-3d-backface-hidden chromeNote-3d-flip-backSide">',
                            '<div class="chromeNote-noteItem-miniIcon"></div>',
                        '</div>',
                    '</div>'
                ].join(""),
                doms: null
            },
            methods: {
                init: function (opt) {
                    var body = document.querySelector("body");
                    var div = document.createElement("div");

                    div.className = "chromeNote-noteItem-threeDWorld chromeNote-setup-3d-perspective theme-note-blue chromeNote-noteItem-decorate-shadow chromeNote-noteItem-resize";
                    div.innerHTML = this.tpl;
                    body.appendChild(div);
                    div = $(div);
                    var pos = div.getAppropriatePos({
                        top: opt.pos.y,
                        left: opt.pos.x
                    });

                    div[0].style.left = pos[1] + "px";
                    div[0].style.top = pos[0] + "px";

                    this.doms = {
                        wrap: div,
                        flipCard: $(div[0].querySelector("#chromeNote-noteItem-flipCard")),
                        header: {
                            date: $(div[0].querySelector("#chromeNote-noteItem-header-label-date")), 
                            cfg: $(div[0].querySelector("#chromeNote-noteItem-header-btn-config")),
                            mini: $(div[0].querySelector("#chromeNote-noteItem-header-btn-mini"))
                        },
                        footer: {
                            wrap: $(div[0].querySelector("#chromeNote-noteItem-footer")),
                            panelMenu: $(div[0].querySelector("#chromeNote-noteItem-footer-menu")),
                            panelColor: $(div[0].querySelector("#chromeNote-noteItem-footer-color")),
                            btn: {
                                color: $(div[0].querySelector("#chromeNote-noteItem-menu-color")),
                                del: $(div[0].querySelector("#chromeNote-noteItem-menu-remove")),
                                btnColor: $(div[0].querySelectorAll(".chromeNote-noteItem-footer-colorItem"))
                            }
                        }
                    };
                    this.bindAnimate();
                    this.bindEvent();
                },
                bindAnimate: function () {
                    var _this = this;
                    this.doms.footer.panelMenu.animSub({
                        open: [
                            {
                                elem: this.doms.footer.wrap,
                                before: {
                                    removedClass: ["chromeNote-noteItem-footer-hideMenu-animate"],
                                    addedClass: ["chromeNote-noteItem-footer-showMenu"]
                                },
                                animateClass: "chromeNote-noteItem-footer-showMenu-animate",
                                after: {
                                    addedClass: []
                                }
                            }
                        ],
                        close: [
                            {
                                elem: this.doms.footer.wrap,
                                before: {
                                    removedClass: ["chromeNote-noteItem-footer-showMenu-animate", "chromeNote-noteItem-footer-showMenu"]
                                },
                                animateClass: "chromeNote-noteItem-footer-hideMenu-animate",
                                after: {
                                    removedClass: ["chromeNote-noteItem-footer-showMenu"]
                                }
                            }
                        ]
                    });
                    this.doms.wrap.animSub({
                        open: [
                            {
                                elem: this.doms.wrap,
                                before: {
                                    addedClass: ["chromeNote-3d-flipStatus"]
                                }
                            }, 
                            {
                                elem: this.doms.flipCard,
                                animateClass: "chromeNote-noteItem-flipCard-back-animate",
                                after: {
                                    addedClass: ["chromeNote-noteItem-flipCard-back"]
                                }
                            }
                        ]
                    })
                    this.doms.footer.panelColor.animSub({
                        open: [
                            {
                                elem: this.doms.footer.wrap,
                                before: {
                                    callback: function () {
                                        // 在打开颜色面板之前 需要关闭配置面板
                                        _this.doms.footer.panelMenu.animPub("close");
                                        // 这里存在一个bug，暂时不解决
                                        _this.doms.footer.wrap.removeClass("chromeNote-noteItem-footer-hideMenu-animate");
                                        _this.doms.footer.wrap.addClass("chromeNote-noteItem-footer-showColor");

                                    }
                                },
                                animateClass: "chromeNote-noteItem-footer-showMenu-animate"
                            }
                        ],
                        close: [
                            {
                                elem: this.doms.footer.wrap,
                                before: {
                                    removedClass: ["chromeNote-noteItem-footer-showMenu-animate"]
                                },
                                animateClass: "chromeNote-noteItem-footer-hideMenu-animate",
                                after: {
                                    removedClass: ["chromeNote-noteItem-footer-showColor"]
                                }
                            }
                        ]
                    })      
                },
                bindEvent: function () {
                    var _this = this;

                    this.doms.footer.btn.btnColor.on("mouseover", function (e) {
                        if (e.target.tagName.toLowerCase() != "em") return;

                        var target = e.target,
                            thisColor = target.getAttribute("data-noteItem-color"),
                            allColor = target.getAttribute("data-noteItem-allColor").split("&");
                        
                        allColor.forEach(function (el, index) {
                            _this.doms.wrap.removeClass("theme-note-" + el);
                        });

                        _this.doms.wrap.addClass("theme-note-" + thisColor);

                    })

                    this.doms.footer.btn.color.on("click", function (e) {
                        _this.doms.footer.panelColor.animPub("open");
                    })

                    this.doms.header.cfg.on("click", function (e) {
                        _this.doms.footer.panelMenu.animPub("open");
                    })

                    this.doms.header.mini.on("click", function (e) {
                        _this.doms.wrap.animPub("open");
                    })  
                }
            }
        });

        
        document.addEventListener("dblclick", function (e) {
            var opt = {
                pos: {
                    x: e.clientX,
                    y: e.clientY
                }
            }
            var note = Note.create(opt);
        });
    </script>
</head>
<body>
</body>
</html>