<!DOCTYPE html>
<html>
<head>
    <title>Command Menu</title>
    <link rel="stylesheet" type="text/css" href="../css/demo/basic.css">
    <link rel="stylesheet" type="text/css" href="../css/demo/theme.css">
    <link rel="stylesheet" type="text/css" href="../css/demo/transform.css">
</head>
<body class="theme-white">
    <div id="chromeNote-threeDWorld" class="chromeNote-setup-3d-perspective">
        <div id="chromeNote-cmdMenu-mask" class="chromeNote-decorate-circle chromeNote-setup-3d-style">
            <div id="chromeNote-cmdMenu-wrap" class="chromeNote-decorate-circle chromeNote-setup-3d-style">
                <div id="chromeNote-cmdMenu-btn" class="chromeNote-decorate-circle chromeNote-setup-3d-style chromeNote-transform-translateZ"></div>
                <ul>
                    <li class="chromeNote-cmdMenu-menuItem-outerWrap chromeNote-setup-3d-style chromeNote-transform-origin-100and100">
                        <a class="chromeNote-cmdMenu-menuItem-innerWrap chromeNote-decorate-circle" href="javascript:void(0)">
                            <span class="chromeNote-cmdMenu-menuItem-text">Menu1</span>
                        </a>
                    </li>
                    <li class="chromeNote-cmdMenu-menuItem-outerWrap chromeNote-setup-3d-style chromeNote-transform-origin-100and100">
                        <a class="chromeNote-cmdMenu-menuItem-innerWrap chromeNote-decorate-circle" href="javascript:void(0)">
                            <span class="chromeNote-cmdMenu-menuItem-text">Menu2</span>
                        </a>
                    </li>
                    <li class="chromeNote-cmdMenu-menuItem-outerWrap chromeNote-setup-3d-style chromeNote-transform-origin-100and100">
                        <a class="chromeNote-cmdMenu-menuItem-innerWrap chromeNote-decorate-circle" href="javascript:void(0)">
                            <span class="chromeNote-cmdMenu-menuItem-text">Menu3</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</body>
<script type="text/javascript">
    function computeAngle(elems) {
        var total = 360;
        var len = elems.length
        var eachAngle = total / len;

        for (var i = 0; i < elems.length; i++) {
            var el = elems[i];
            var innerEl = el.querySelector("a");

            /*
                eachAngle - 90: 保证最上方有一条直线
            */
            var outerRotateDeg = (i * eachAngle) - (eachAngle - 90); 
            var rotate = " rotate(" + outerRotateDeg + "deg) ";

            var outerSkewXDeg = 90 - eachAngle;
            var skewX = " skewX(" + outerSkewXDeg + "deg) ";

            el.setAttribute("data-rotate", outerRotateDeg);
            el.setAttribute("data-skewX", outerSkewXDeg);
            el.style.webkitTransform += rotate + skewX;

            var innerSkewXDeg = outerSkewXDeg * (-1);
            var innerRotateDeg = (90 - parseFloat(eachAngle) / 2) * (-1);

            rotate = " rotate(" + innerRotateDeg + "deg) ";
            skewX = " skewX(" + innerSkewXDeg + "deg) ";

            innerEl.style.webkitTransform += skewX + rotate;

            var text = innerEl.querySelector("span");

            var textRotateDeg = innerRotateDeg * (-1) - outerRotateDeg;
            var textRotate = " rotate(" + textRotateDeg + "deg) ";
            text.style.webkitTransform += textRotate;
        }
    }


    var elems = document.querySelectorAll("li");
    computeAngle(elems);

    var links = document.querySelectorAll("li");
    var translateZ = "20";
    for (var i = 0; i < links.length; i++) {
        var link = links[i];
        link.addEventListener("mouseover", function (e) {
            var target = e.target;
            var outerRotateDeg = target.getAttribute("data-rotate");
            var rotate = " rotate(" + outerRotateDeg + "deg) ";

            var outerSkewXDeg = target.getAttribute("data-skewX");
            var skewX = " skewX(" + outerSkewXDeg + "deg) ";

            var translateZ = " translateZ(20px) ";

            target.style.webkitTransform = rotate + skewX + translateZ;

        }, false);

        link.addEventListener("mouseout", function (e) {
            var target = e.target;
            var outerRotateDeg = target.getAttribute("data-rotate");
            var rotate = " rotate(" + outerRotateDeg + "deg) ";

            var outerSkewXDeg = target.getAttribute("data-skewX");
            var skewX = " skewX(" + outerSkewXDeg + "deg) ";

            var translateZ = " translateZ(0px) ";

            target.style.webkitTransform = rotate + skewX + translateZ;

        }, false);
    }

    var worldXAngle, worldYAngle, backupX, backupY;
    // var disableMousemove = true;
    var disableMousemove = false;

    window.addEventListener( 'mousemove', function( e ) {
        if (disableMousemove) return false;

        var xPercent = parseFloat(353) / window.innerWidth;
        var yPercent = parseFloat(252) / window.innerHeight;

        backupX = worldXAngle, backupY = worldYAngle;

        worldYAngle = -( xPercent - ( e.clientX / window.innerWidth ) ) * 180;
        worldXAngle = ( yPercent - ( e.clientY / window.innerHeight ) ) * 180;

        if (Math.abs(worldXAngle) >= 12) worldXAngle = backupX;
        if (Math.abs(worldYAngle) >= 12) worldYAngle = backupY;

        var world = document.querySelector("#chromeNote-cmdMenu-wrap");
        var outer = document.querySelector("#chromeNote-cmdMenu-mask");

        world.style.webkitTransform = 'translateZ(0px ) \
        rotateX( ' + worldXAngle * (-1) + 'deg) \
        rotateY( ' + worldYAngle * (-1) + 'deg)';

        outer.style.webkitTransform = 'translateZ(0px ) \
        rotateX( ' + worldXAngle * (-1) + 'deg) \
        rotateY( ' + worldYAngle * (-1) + 'deg)';
    } );
</script>
</html>